{% extends 'blog/base.html' %}
{% block title %}{{ post.title }}{% endblock %}
{% block content %}
<div class="card shadow p-4">
  <h2 class="text-success">{{ post.title }}</h2>
  {% if post.image %}
    <img src="{{ post.image.url }}" class="img-fluid mb-3 rounded">
  {% endif %}
  <p>{{ post.content }}</p>
  <p class="text-muted small">By {{ post.author.first_name }} • {{ post.date_posted|date:"M d, Y H:i" }}</p>

  <hr>

  <button class="btn btn-outline-success btn-sm" id="likeBtn">❤️ Like ({{ post.likes.count }})</button>

  <script>
  document.getElementById('likeBtn').onclick = async () => {
    const res = await fetch("{% url 'toggle_like' post.id %}");
    const data = await res.json();
    if (data.likes_count !== undefined)
      document.getElementById('likeBtn').innerText = `❤️ Like (${data.likes_count})`;
  };
  </script>

  <hr>
  <h5>Comments ({{ post.comments.count }})</h5>
  {% for comment in post.comments.all %}
  <div class="card mb-2 p-2">
    <p class="mb-1">{{ comment.content }}</p>
    <small class="text-muted">— {{ comment.author.first_name }} • {{ comment.created_at|date:"M d, Y H:i" }}</small>
  </div>
  {% empty %}
  <p>No comments yet.</p>
  {% endfor %}

  {% if user.is_authenticated %}
  <form method="POST" class="mt-3">
    {% csrf_token %}
    <textarea name="content" rows="3" class="form-control mb-2" placeholder="Write a comment..." required></textarea>
    <button class="btn btn-success">Add Comment</button>
  </form>
  {% else %}
  <p><a href="{% url 'login' %}">Login</a> to comment.</p>
  {% endif %}
</div>
{% endblock %}
